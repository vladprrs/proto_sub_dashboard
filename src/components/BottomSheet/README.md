# BottomSheet Component

Отрефакторенный компонент BottomSheet с чистой архитектурой и разделением ответственности.

## Архитектура

```
BottomSheet/
├── BottomSheet.tsx          # Основной компонент
├── constants.ts             # Константы и типы
├── utils.ts                 # Утилиты для работы с жестами, DOM и событиями
├── hooks/                   # Кастомные хуки
│   ├── useBottomSheetState.ts    # Управление состоянием шторки
│   ├── useDragHandling.ts        # Обработка перетаскивания
│   ├── useTouchHandling.ts       # Обработка touch событий
│   ├── useScrollHandling.ts      # Обработка скролла
│   ├── useGlobalMouseEvents.ts   # Глобальные события мыши
│   └── index.ts                  # Экспорт всех хуков
├── index.ts                 # Основной экспорт
└── README.md               # Документация
```

## Основные принципы

### 1. Разделение ответственности
- Каждый хук отвечает за одну конкретную область функциональности
- Утилиты вынесены в отдельные модули
- Константы централизованы

### 2. Чистые функции
- Все утилиты являются чистыми функциями
- Хуки имеют четкие интерфейсы
- Минимальные побочные эффекты

### 3. Типизация
- Полная типизация TypeScript
- Интерфейсы для всех состояний и действий
- Строгая типизация событий

## Хуки

### useBottomSheetState
Управляет основным состоянием шторки:
- `currentHeight` - текущая высота
- `isExpanded` - развернута ли шторка
- `isExpanding` - процесс разворачивания
- `expandSheet()` - развернуть шторку
- `collapseSheet()` - свернуть шторку
- `toggleSheet()` - переключить состояние

### useDragHandling
Обрабатывает перетаскивание dragger'а:
- `isDragging` - состояние перетаскивания
- `startDrag()` - начать перетаскивание
- `updateDrag()` - обновить позицию
- `endDrag()` - завершить перетаскивание

### useTouchHandling
Управляет touch событиями контента:
- `touchState` - состояние touch
- `handleTouchStart()` - обработка начала касания
- `handleTouchMove()` - обработка движения
- `resetTouchState()` - сброс состояния

### useScrollHandling
Обрабатывает скролл контента:
- `handleScroll()` - основная логика скролла
- Автоматическое разворачивание/сворачивание

### useGlobalMouseEvents
Управляет глобальными событиями мыши:
- Автоматическое добавление/удаление слушателей
- Блокировка скролла body при перетаскивании

## Утилиты

### gestureUtils
- `getScrollDirection()` - определение направления скролла
- `isSwipeUp()` - проверка свайпа вверх
- `calculateDragHeight()` - вычисление высоты при перетаскивании
- `getSnapHeight()` - определение snap точки

### domUtils
- `lockBodyScroll()` - блокировка скролла body
- `unlockBodyScroll()` - разблокировка скролла body
- `resetScroll()` - сброс скролла элемента
- `isAtScrollTop()` - проверка позиции скролла

### eventUtils
- `preventDefault()` - предотвращение стандартного поведения
- `getClientY()` - получение Y координаты из события

### animationUtils
- `shouldDisableTransition()` - проверка отключения анимации
- `getTransitionClasses()` - получение CSS классов анимации

## Константы

### BOTTOM_SHEET_CONSTANTS
- `TOUCH_THRESHOLD` - порог для определения свайпа
- `SNAP_THRESHOLD_RATIO` - соотношение для snap точки
- `TRANSITION_DURATION` - длительность анимации
- `Z_INDEX` - z-index компонента

## Использование

```tsx
import BottomSheet from '../components/BottomSheet'

<BottomSheet
  minHeight={60}
  maxHeight={100}
  defaultHeight={60}
  className="custom-class"
>
  <div>Содержимое шторки</div>
</BottomSheet>
```

## Преимущества новой архитектуры

1. **Модульность** - каждый аспект функциональности изолирован
2. **Тестируемость** - хуки и утилиты легко тестировать
3. **Переиспользование** - хуки можно использовать в других компонентах
4. **Читаемость** - код легко понять и поддерживать
5. **Расширяемость** - легко добавлять новую функциональность
6. **Производительность** - оптимизированные хуки с useCallback
7. **Типобезопасность** - полная типизация TypeScript

## Миграция

Старый компонент полностью заменен новой архитектурой. Все существующие импорты продолжают работать без изменений. 